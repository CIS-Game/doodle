<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ü¶Ñ Unicorn PAC-MAN</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
        }
        canvas {
            display: block;
            max-width: 100vw;
            max-height: 100vh;
            width: 100%;
            height: 100vh;
            background: #000;
            image-rendering: pixelated;
            touch-action: none;
        }
        .ui {
            position: fixed;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            color: #ffd700;
            font-size: 18px;
            font-weight: 600;
            text-shadow: 2px 2px 4px #000;
            z-index: 100;
            pointer-events: none;
        }
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            pointer-events: none;
        }
        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            color: #ffd700;
            border: 3px solid #ffd700;
            display: none;
            font-size: 20px;
        }
        button {
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(255,107,107,0.4);
        }
        button:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div class="ui">
        <div>‚≠ê <span id="score">0</span></div>
        <div>‚ù§Ô∏è <span id="lives">3</span></div>
    </div>
    <canvas id="gameCanvas"></canvas>
    
    <div id="gameOver" class="game-over">
        <div style="font-size: 28px; margin-bottom: 20px;">ü¶Ñ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</div>
        <div style="font-size: 24px; margin-bottom: 25px;">–°—á—ë—Ç: <span id="finalScore">0</span></div>
        <button onclick="restartGame()">üéÆ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const livesEl = document.getElementById('lives');
        const gameOverEl = document.getElementById('gameOver');
        const finalScoreEl = document.getElementById('finalScore');

        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è
        function resize() {
            canvas.width = Math.min(window.innerWidth, 400);
            canvas.height = Math.min(window.innerHeight, 500);
            tileSize = Math.floor(Math.min(canvas.width, canvas.height * 0.9) / 19);
        }
        let tileSize = 20;
        resize();
        window.addEventListener('resize', resize);

        // –õ–∞–±–∏—Ä–∏–Ω—Ç (1=—Å—Ç–µ–Ω–∞, 0=–ø—É—Å—Ç–æ, 2=–µ–¥–∞)
        const maze = [
            "111111111111111111111",
            "100000000000000000001",
            "1OOOOOO1OOOOOO1OOOOO1",
            "1O11111O1O11111O111O1",
            "1O11111O1O11111O111O1",
            "100000000000000000001",
            "1O111O1111111O111O111",
            "1OOOOO1OOOOOO1OOOOO111",
            "11111O1111111O11111111",
            "     O1111111O111     ",
            "11111O1111111O11111111",
            "1OOOOO1OOOOOO1OOOOO111",
            "1O111O1111111O111O111",
            "100000000000000000001",
            "1O11111O1O11111O111O1",
            "1O11111O1OOOOOO1OOOO1",
            "1000000000OOOOO0000001",
            "111111111111111111111"
        ];

        // –ò–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        let game = {
            score: 0,
            lives: 3,
            running: false,
            level: 1
        };

        let unicorn = {
            x: 1,
            y: 15,
            dir: { x: 0, y: 0 },
            nextDir: { x: 0, y: 0 },
            speed: 0.15
        };

        let ghosts = [
            { x: 9, y: 7, color: '#ff4444', dx: 1, dy: 0 },  // –ö—Ä–∞—Å–Ω—ã–π
            { x: 9, y: 8, color: '#ff69b4', dx: 0, dy: 1 },  // –†–æ–∑–æ–≤—ã–π
            { x: 9, y: 9, color: '#00bfff', dx: -1, dy: 0 }, // –ì–æ–ª—É–±–æ–π
            { x: 10, y: 8, color: '#ff8c00', dx: 0, dy: -1 } // –û—Ä–∞–Ω–∂–µ–≤—ã–π
        ];

        let pellets = []; // –¢–æ—á–∫–∏ –µ–¥—ã

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            pellets = [];
            for (let y = 0; y < maze.length; y++) {
                for (let x = 0; x < maze[y].length; x++) {
                    if (maze[y][x] === '0') {
                        pellets.push({ x, y });
                    }
                }
            }
        }

        // –ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (—Å–≤–∞–π–ø—ã)
        let touchStart = { x: 0, y: 0 };
        
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            touchStart = {
                x: (touch.clientX - rect.left) / tileSize,
                y: (touch.clientY - rect.top) / tileSize
            };
        }, { passive: false });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            if (!game.running) {
                game.running = true;
                return;
            }
            
            const rect = canvas.getBoundingClientRect();
            const touchEnd = e.changedTouches[0];
            const endX = (touchEnd.clientX - rect.left) / tileSize;
            const endY = (touchEnd.clientY - rect.top) / tileSize;
            
            const dx = endX - touchStart.x;
            const dy = endY - touchStart.y;
            
            if (Math.abs(dx) > Math.abs(dy)) {
                unicorn.nextDir = dx > 0 ? { x: 1, y: 0 } : { x: -1, y: 0 };
            } else {
                unicorn.nextDir = dy > 0 ? { x: 0, y: 1 } : { x: 0, y: -1 };
            }
        }, { passive: false });

        // –ö–ª–∏–∫ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ (iOS)
        canvas.addEventListener('click', () => {
            if (!game.running) game.running = true;
        });

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
        function draw() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const ts = tileSize;
            const ox = (canvas.width - maze[0].length * ts) / 2;
            const oy = (canvas.height - maze.length * ts) / 2;

            // –°—Ç–µ–Ω—ã (—Å–∏–Ω–∏–µ)
            ctx.fillStyle = '#0000ff';
            for (let y = 0; y < maze.length; y++) {
                for (let x = 0; x < maze[y].length; x++) {
                    if (maze[y][x] === '1') {
                        ctx.fillRect(ox + x * ts, oy + y * ts, ts, ts);
                    }
                }
            }

            // –ï–¥–∞ (–±–µ–ª—ã–µ —Ç–æ—á–∫–∏)
            ctx.fillStyle = '#ffffff';
            pellets.forEach(p => {
                ctx.beginPath();
                ctx.arc(ox + (p.x + 0.5) * ts, oy + (p.y + 0.5) * ts, ts * 0.15, 0, Math.PI * 2);
                ctx.fill();
            });

            // –ï–¥–∏–Ω–æ—Ä–æ–≥ ü¶Ñ
            ctx.shadowColor = '#ffd700';
            ctx.shadowBlur = 15;
            ctx.font = `${ts * 0.85}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ü¶Ñ', 
                ox + (unicorn.x + 0.5) * ts, 
                oy + (unicorn.y + 0.5) * ts
            );
            ctx.shadowBlur = 0;

            // –ü—Ä–∏–∑—Ä–∞–∫–∏
            ghosts.forEach(ghost => {
                ctx.shadowColor = ghost.color;
                ctx.shadowBlur = 10;
                ctx.fillStyle = ghost.color;
                ctx.beginPath();
                ctx.arc(ox + (ghost.x + 0.5) * ts, oy + (ghost.y + 0.5) * ts, ts * 0.4, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
                
                // –ì–ª–∞–∑–∞
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(ox + (ghost.x + 0.35) * ts, oy + (ghost.y + 0.35) * ts, ts * 0.08, 0, Math.PI * 2);
                ctx.arc(ox + (ghost.x + 0.65) * ts, oy + (ghost.y + 0.35) * ts, ts * 0.08, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–∏ —Å–æ —Å—Ç–µ–Ω–æ–π
        function isWall(x, y) {
            const ix = Math.floor(x);
            const iy = Math.floor(y);
            return maze[iy] && maze[iy][ix] === '1';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã
        function update() {
            if (!game.running) {
                draw();
                requestAnimationFrame(update);
                return;
            }

            // –î–≤–∏–∂–µ–Ω–∏–µ –µ–¥–∏–Ω–æ—Ä–æ–≥–∞
            if (!isWall(unicorn.x + unicorn.nextDir.x, unicorn.y + unicorn.nextDir.y)) {
                unicorn.dir = { ...unicorn.nextDir };
            }
            const nx = unicorn.x + unicorn.dir.x * unicorn.speed;
            const ny = unicorn.y + unicorn.dir.y * unicorn.speed;
            if (!isWall(nx, unicorn.y) && !isWall(nx, unicorn.y + 0.8)) unicorn.x = nx;
            if (!isWall(unicorn.x, ny) && !isWall(unicorn.x + 0.8, ny)) unicorn.y = ny;

            // –ì—Ä–∞–Ω–∏—Ü—ã —ç–∫—Ä–∞–Ω–∞ (—Ç—É–Ω–Ω–µ–ª–∏)
            if (unicorn.x < 0) unicorn.x = maze[0].length - 1;
            if (unicorn.x >= maze[0].length) unicorn.x = 0;

            // –ï–¥–∞
            const ux = Math.floor(unicorn.x);
            const uy = Math.floor(unicorn.y);
            const pelletIndex = pellets.findIndex(p => p.x === ux && p.y === uy);
            if (pelletIndex > -1) {
                pellets.splice(pelletIndex, 1);
                game.score += 10;
                scoreEl.textContent = game.score;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
            if (pellets.length === 0) {
                game.level++;
                init();
            }

            // –ü—Ä–∏–∑—Ä–∞–∫–∏ (–ø—Ä–æ—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ)
            ghosts.forEach(ghost => {
                const dirs = [
                    { x: 1, y: 0 }, { x: -1, y: 0 },
                    { x: 0, y: 1 }, { x: 0, y: -1 }
                ];
                let moved = false;
                for (let dir of dirs) {
                    if (!isWall(ghost.x + dir.x, ghost.y + dir.y)) {
                        ghost.dx = dir.x * 0.08;
                        ghost.dy = dir.y * 0.08;
                        moved = true;
                        break;
                    }
                }
                ghost.x += ghost.dx;
                ghost.y += ghost.dy;
            });

            draw();
            requestAnimationFrame(update);
        }

        function endGame() {
            game.running = false;
            finalScoreEl.textContent = game.score;
            gameOverEl.style.display = 'block';
        }

        function restartGame() {
            game = { score: 0, lives: 3, running: false, level: 1 };
            unicorn = { x: 1, y: 15, dir: { x: 0, y: 0 }, nextDir: { x: 0, y: 0 }, speed: 0.15 };
            ghosts.forEach(g => {
                g.x = 9 + Math.floor(Math.random() * 2) - 0.5;
                g.y = 7 + Math.floor(Math.random() * 3);
            });
            scoreEl.textContent = 0;
            livesEl.textContent = 3;
            gameOverEl.style.display = 'none';
            init();
        }

        // –°—Ç–∞—Ä—Ç
        init();
        update();
    </script>
</body>
</html>
