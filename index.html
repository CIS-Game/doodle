<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü¶Ñ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –ï–¥–∏–Ω–æ—Ä–æ–≥</title>
    <style>
        body {
            margin: 0;
            padding: 15px;
            font-family: Arial, sans-serif;
            background: linear-gradient(180deg, #1e3c72 0%, #2a5298 50%, #0f3460 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }
        canvas {
            border: 4px solid #ffd700;
            border-radius: 20px;
            background: linear-gradient(45deg, #e0f7fa, #f0f8ff);
            box-shadow: 0 15px 35px rgba(255,215,0,0.4);
            max-width: 95vw;
            max-height: 85vh;
            touch-action: pan-y;
        }
        .ui {
            margin: 10px 0;
            font-size: 18px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            display: flex;
            gap: 25px;
        }
        .stats {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.95);
            padding: 35px;
            border-radius: 25px;
            text-align: center;
            font-size: 26px;
            color: #dc143c;
            border: 4px solid #ffd700;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        }
        button {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            color: #fff;
            border: none;
            padding: 15px 30px;
            font-size: 20px;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
            box-shadow: 0 8px 25px rgba(255,107,107,0.4);
        }
        button:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="ui">
        <div class="stats">üéÅ –û—á–∫–∏: <span id="score">0</span></div>
        <div class="stats">‚ù§Ô∏è –ñ–∏–∑–Ω–∏: <span id="lives">3</span></div>
    </div>
    <canvas id="gameCanvas" width="380" height="580"></canvas>
    <div id="gameOver" class="game-over" style="display: none;">
        <div>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! ‚ùÑÔ∏è</div>
        <div>–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç: <span id="finalScore">0</span> üéÅ</div>
        <button onclick="restartGame()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞ ü¶Ñ</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const livesEl = document.getElementById('lives');
        const gameOverEl = document.getElementById('gameOver');
        const finalScoreEl = document.getElementById('finalScore');

        // –ò–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        let score = 0;
        let lives = 3;
        let gameRunning = true;
        let unicorn = { x: 170, y: 450, width: 50, height: 50, targetX: 170 };
        let gifts = [];
        let badItems = [];
        let snowflakes = [];
        let particles = [];
        let touchStartX = 0;

        // –ù–æ–≤–æ–≥–æ–¥–Ω—è—è –º—É–∑—ã–∫–∞
        let audioContext;
        let musicPlaying = false;
        
        function playChristmasMusic() {
            if (musicPlaying) return;
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                musicPlaying = true;
                
                // –ù–æ–≤–æ–≥–æ–¥–Ω—è—è –º–µ–ª–æ–¥–∏—è Jingle Bells
                const notes = [659, 659, 659, 523, 587, 659, 0, 659, 659, 659, 783, 587, 523, 0];
                let noteIndex = 0;
                
                function playNote() {
                    if (!gameRunning || !musicPlaying) return;
                    
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = notes[noteIndex] || 659;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.4);
                    
                    noteIndex = (noteIndex + 1) % notes.length;
                    setTimeout(playNote, 450);
                }
                playNote();
            } catch(e) {}
        }

        // –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
        function playSound(frequency, duration) {
            try {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.connect(gain);
                gain.connect(audioContext.destination);
                osc.frequency.value = frequency;
                osc.type = 'sine';
                gain.gain.setValueAtTime(0.3, audioContext.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                osc.start();
                osc.stop(audioContext.currentTime + duration);
            } catch(e) {}
        }

        // –°–Ω–µ–≥
        function createSnow() {
            snowflakes.push({
                x: Math.random() * canvas.width,
                y: -10,
                size: Math.random() * 4 + 2,
                speed: Math.random() * 2 + 0.5,
                sway: Math.random() * 0.02
            });
        }

        // –ü–æ–¥–∞—Ä–∫–∏
        function createGift() {
            if (Math.random() < 0.025) {
                gifts.push({
                    x: Math.random() * (canvas.width - 35),
                    y: -35,
                    emoji: ['üéÅ', 'üéÑ', '‚≠ê', 'üîî'][Math.floor(Math.random() * 4)],
                    width: 35,
                    height: 35,
                    speed: 3 + Math.random() * 2
                });
            }
        }

        // –ü–ª–æ—Ö–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã
        function createBadItem() {
            if (Math.random() < 0.015) {
                badItems.push({
                    x: Math.random() * (canvas.width - 35),
                    y: -35,
                    emoji: ['üß®', 'üåã', 'üí•', 'ü¶†'][Math.floor(Math.random() * 4)],
                    width: 35,
                    height: 35,
                    speed: 4 + Math.random() * 2
                });
            }
        }

        // –ß–∞—Å—Ç–∏—Ü—ã
        function createParticles(x, y, color) {
            for (let i = 0; i < 10; i++) {
                particles.push({
                    x, y,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8,
                    life: 40,
                    maxLife: 40,
                    color
                });
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã
        function update() {
            if (!gameRunning) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // –§–æ–Ω –Ω–µ–±–∞
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#98D8C8');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // –°–Ω–µ–≥
            snowflakes.forEach((snow, i) => {
                snow.x += Math.sin(snow.y * snow.sway) * 0.5;
                snow.y += snow.speed;
                ctx.save();
                ctx.globalAlpha = 0.8;
                ctx.font = `${snow.size}px Arial`;
                ctx.fillText('‚ùÑÔ∏è', snow.x, snow.y);
                ctx.restore();
                if (snow.y > canvas.height) snowflakes.splice(i, 1);
            });
            if (Math.random() < 0.6) createSnow();

            // –î–≤–∏–∂–µ–Ω–∏–µ –µ–¥–∏–Ω–æ—Ä–æ–≥–∞ (–ø–ª–∞–≤–Ω–æ–µ)
            unicorn.x += (unicorn.targetX - unicorn.x) * 0.25;

            // –ï–¥–∏–Ω–æ—Ä–æ–≥ ü¶Ñ
            ctx.shadowColor = '#ffd700';
            ctx.shadowBlur = 15;
            ctx.font = '50px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ü¶Ñ', unicorn.x, unicorn.y);
            ctx.shadowBlur = 0;

            // –ü–æ–¥–∞—Ä–∫–∏
            gifts.forEach((gift, i) => {
                gift.y += gift.speed;
                ctx.font = '35px Arial';
                ctx.fillText(gift.emoji, gift.x, gift.y + 28);

                // –ö–æ–ª–ª–∏–∑–∏—è
                if (unicorn.x - 25 < gift.x + gift.width &&
                    unicorn.x + 25 > gift.x &&
                    unicorn.y < gift.y + gift.height &&
                    unicorn.y + unicorn.height > gift.y) {
                    score += 10;
                    scoreEl.textContent = score;
                    createParticles(gift.x + 17, gift.y + 17, '#ffd700');
                    playSound(800, 0.15);
                    gifts.splice(i, 1);
                }
                if (gift.y > canvas.height) gifts.splice(i, 1);
            });

            // –ü–ª–æ—Ö–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã
            badItems.forEach((bad, i) => {
                bad.y += bad.speed;
                ctx.font = '35px Arial';
                ctx.fillText(bad.emoji, bad.x, bad.y + 28);

                // –ö–æ–ª–ª–∏–∑–∏—è
                if (unicorn.x - 25 < bad.x + bad.width &&
                    unicorn.x + 25 > bad.x &&
                    unicorn.y < bad.y + bad.height &&
                    unicorn.y + unicorn.height > bad.y) {
                    lives--;
                    livesEl.textContent = lives;
                    createParticles(bad.x + 17, bad.y + 17, '#ff4500');
                    playSound(250, 0.3);
                    badItems.splice(i, 1);
                    if (lives <= 0) endGame();
                }
                if (bad.y > canvas.height) badItems.splice(i, 1);
            });

            // –ß–∞—Å—Ç–∏—Ü—ã
            particles.forEach((p, i) => {
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                ctx.save();
                ctx.globalAlpha = p.life / p.maxLife;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 5, 5);
                ctx.restore();
                if (p.life <= 0) particles.splice(i, 1);
            });

            // –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
            createGift();
            createBadItem();

            requestAnimationFrame(update);
        }

        // –°–µ–Ω—Å–æ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (—Å–≤–∞–π–ø)
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            touchStartX = e.touches[0].clientX;
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!touchStartX) return;
            const touchX = e.touches[0].clientX;
            const rect = canvas.getBoundingClientRect();
            const canvasX = touchX - rect.left;
            unicorn.targetX = Math.max(25, Math.min(canvas.width - 25, canvasX));
        });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            touchStartX = 0;
        });

        // –ú—ã—à—å –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            unicorn.targetX = Math.max(25, Math.min(canvas.width - 25, e.clientX - rect.left));
        });

        function endGame() {
            gameRunning = false;
            finalScoreEl.textContent = score;
            gameOverEl.style.display = 'block';
            musicPlaying = false;
        }

        function restartGame() {
            score = 0;
            lives = 3;
            gameRunning = true;
            unicorn.x = 170;
            unicorn.targetX = 170;
            gifts = [];
            badItems = [];
            snowflakes = [];
            particles = [];
            scoreEl.textContent = score;
            livesEl.textContent = lives;
            gameOverEl.style.display = 'none';
            musicPlaying = false;
            setTimeout(() => {
                playChristmasMusic();
                update();
            }, 100);
        }

        // –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã
        playChristmasMusic();
        update();
    </script>
</body>
</html>
